<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .upload-form-container,
        .search-form-container {
            display: none; /* Hide forms initially */
        }
        .upload-form-container.active,
        .search-form-container.active {
            display: block; /* Show active form */
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo">
            <img src="LOGOLAV.png" style="width: 40px;">
        </div>
        <ul class="menu">
            <li><a href="index.html">Գլխավոր մենյու</a></li>
            <li><a href="about.html">Ապրանքներ</a></li>
            <li><a href="services.html">Պատվերներ</a></li>
        </ul>
    </nav>

    <div class="selection-container">
        <button id="upload-btn">Ավելացնել ապրանք</button>
        <button id="search-btn">Որոնել ապրանք</button>
    </div>

    <div id="upload-form-container" class="upload-form-container">
        <h1>Ավելացնել ապրանք</h1>
        <form id="product-form">
            <div class="form-group">
                <label for="longitude">Երկայնություն (Longitude):</label>
                <input type="text" id="longitude" name="longitude" required>
            </div>
            <div class="form-group">
                <label for="latitude">Լայնություն (Latitude):</label>
                <input type="text" id="latitude" name="latitude" required>
            </div>
            <div class="form-group">
                <label for="weight">Քաշը:</label>
                <input type="number" id="weight" name="weight" step="0.01" required>
            </div>
            <div class="form-group">
                <label for="price">Գին ($):</label>
                <input type="number" id="price" name="price" step="0.01" required>
            </div>
            <div class="form-group">
                <label for="name">Ապրանքի անվանումը:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="type">Տեսակ:</label>
                <select id="type" name="type" required>
                    <option value="Ինդիկա">Ինդիկա</option>
                    <option value="Սատիվա">Սատիվա</option>
                    <option value="Քար">Քար</option>
                    <option value="Կոկաին">Կոկաին</option>
                    <option value="Շոկո">Կոկաին</option>
                    <option value="Lxtz">Lxtz</option>
                    <option value="LSD">LSD</option>
                </select>
            </div>
            <div class="form-group">
                <label for="location">Տեղադրման վայր:</label>
                <select id="location" name="location" required>
                    <option value="Ավան">Ավան</option>
                    <option value="Զեյթուն">Զեյթւն</option>
                    <option value="Բանգլադեշ">Բանգլադեշ</option>
                    <option value="3-րդ Մաս">3րդ Մաս</option>
                    <option value="Կոմիտաս">Կոմիտաս</option>
                    <option value="Էրեբունի">Երեբւնի</option>
                    <option value="Նորագավիթ">Նորագավիտ</option>
                    <option value="Շենգավիթ">Շենգավիտ</option>
                </select>
            </div>

            <div class="form-group">
                <label for="identifier">Նույնականացուցիչ:</label>
                <input type="text" id="identifier" name="identifier" readonly>
            </div>
            <div class="form-group">
                <label for="image">Ապրանքի պատկեր:</label>
                <input type="file" id="image" name="image" accept="image/*" required>
            </div>
            <div class="form-group">
                <label for="locationimage">Տեղադրության պատկեր:</label>
                <input type="file" id="locationimage" name="locationimage" accept="image/*" required>
            </div>
            <button type="submit">Submit</button>
        </form>
    </div>

    <div id="search-form-container" class="search-form-container">
        <h1>Որոնել ապրանք</h1>
        <form id="search-form">
            <div class="form-group">
                <label for="search-identifier">Նույնականացուցիչ:</label>
                <input type="text" id="search-identifier" name="search-identifier" required>
            </div>
            <button type="submit">Search</button>
        </form>
        <div id="search-results"></div>
    </div>

    <script>
        // Function to generate a random identifier
        function generateIdentifier(length) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Generate a random identifier when the page loads
            const identifierField = document.getElementById('identifier');
            identifierField.value = generateIdentifier(10); // Generate a 10-character identifier
        });

        document.getElementById('upload-btn').addEventListener('click', function () {
            document.getElementById('upload-form-container').classList.add('active');
            document.getElementById('search-form-container').classList.remove('active');
        });

        document.getElementById('search-btn').addEventListener('click', function () {
            document.getElementById('upload-form-container').classList.remove('active');
            document.getElementById('search-form-container').classList.add('active');
        });

        document.getElementById('product-form').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent the default form submission

            const formData = new FormData(this);

            fetch('https://site-45i5.onrender.com/submit-product', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error('Network response was not ok.');
                }
            })
            .then(data => {
                alert('Product successfully uploaded.');
                console.log(data);

                // Clear the form fields
                document.getElementById('product-form').reset();

                // Regenerate a new identifier
                const identifierField = document.getElementById('identifier');
                identifierField.value = generateIdentifier(10); // Generate a new 10-character identifier
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error uploading the product. Please try again.');
            });
        });

        document.getElementById('search-form').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent the default form submission

            const searchIdentifier = document.getElementById('search-identifier').value;

            fetch(`https://site-45i5.onrender.com/product/${encodeURIComponent(searchIdentifier)}`, {
                method: 'GET'
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Network response was not ok.');
                }
            })
            .then(data => {
                const resultsContainer = document.getElementById('search-results');
                if (data) {
                    resultsContainer.innerHTML = `
                        <h2>Product Found</h2>
                        <p><strong>ID:</strong> ${data.identifier}</p>
                        <p><strong>Name:</strong> ${data.name}</p>
                        <p><strong>Price:</strong> $${data.price}</p>
                        <p><strong>Weight:</strong> ${data.weight} kg</p>
                        <p><strong>Type:</strong> ${data.type}</p>
                        <p><strong>Longitude:</strong> ${data.longitude}</p>
                        <p><strong>Latitude:</strong> ${data.latitude}</p>
                        <button id="delete-btn">Delete Product</button>
                    `;

                    document.getElementById('delete-btn').addEventListener('click', function () {
                        fetch(`https://site-45i5.onrender.com/product/${encodeURIComponent(data.identifier)}`, {
                            method: 'DELETE'
                        })
                        .then(response => {
                            if (response.ok) {
                                alert('Product successfully deleted.');
                                // Clear the results container or update it as needed
                                resultsContainer.innerHTML = '';
                            } else {
                                throw new Error('Network response was not ok.');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('There was an error deleting the product. Please try again.');
                        });
                    });
                } else {
                    resultsContainer.innerHTML = '<p>No product found with that identifier.</p>';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error retrieving the product. Please try again.');
            });
        });
    </script>
</body>
</html>
