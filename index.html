<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map with Product Locations</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="style.css" />
    <style>
        #map {
            height: 300px;
            width: 100%;
            max-width: 400px;
            border-radius: 10px;
            margin-bottom: 20px;
            margin: 0 auto;
            
        }
        
        
        
        * {
            -webkit-tap-highretro-color: transparent;
         }
         .order-detail {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
        }
        .order-list {
            padding-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center; /* Centers items horizontally */
        }
        
        .order-item {
            color: white;
            border-radius: 15px;
            width: 90%;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #1d1d1d;
        }
        
        *:focus {
            outline: none;
        }
        .my-order-text {
            padding-top: 10px;
            font-size: 19px;
            font-weight: 800;
            color: white;
            text-align: center; /* Center horizontally */
        }
        
        .loading{
            height:50px;
            width: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor:progress;
            margin: 0 auto;
            border-radius: 50%;
            border-top: 5px solid gold;
            border-bottom: 5px solid transparent;
            border-left: 5px solid gold;
            border-right: 5px solid transparent;
        
            animation: loading 1s linear infinite;
        }
        
        
        
        
        @keyframes loading {
          0% {
           transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }
        
        
        
        
        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 9999; /* Ensure the modal is on top of everything */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6); /* Darker background for better contrast */
        }
        
        .modal-content {
        position: relative; /* Ensure the pseudo-element is positioned relative to this element */
        background: linear-gradient(to top, rgba(152, 255, 121, 1) 0%, rgb(21, 21, 21) 50%);
        margin: 10% auto; /* Centering the modal */
        padding: 20px;
        width: 80%;
        color: white;
        max-width: 600px;
        border-radius: 10px;
        text-align: center; /* Centering text and content */
        z-index: 1; /* Ensure the modal content is above the pseudo-element */
        }
        
        .modal-content::before {
        content: ""; /* Required to generate the pseudo-element */
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(21, 21, 21, 0.6); /* Fixed background color */
        z-index: -1; /* Place it behind the modal content */
        border-radius: 10px; /* Match the border-radius of the modal content */
        }
        
        
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        
        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        /* Additional styling for QR code and address */
        #qr-code img {
            max-width: 100%;
            height: auto;
        }
        
        #amount {
            font-weight: bold;
        }
        
        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #151515;
        }
        
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #1d1d1d;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 20px;
        }
        
        .navbar .logo {
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .navbar .menu {
            display: flex;
            list-style-type: none;
            margin: 0;
            padding: 0;
        }
        
        .navbar .menu li {
            margin-left: 20px;
        
        }
        
        .navbar .menu li a {
            font-size: 13px;
            color: white;
            text-decoration: none;
            border-radius: 20px;
            transition: background-color 0.3s;
        }
        
        .navbar .menu li a:hover {
            background-color: #575757;
        }
        
        .product-menu {
            position: absolute;
            width: calc(100% - 40px);
            max-width: 400px;
            height: 40%;
            background-color: #1d1d1d;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 15px;
            padding: 10px;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        #loading-animation {
            display: none; /* Hidden by default */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #ffffff;
        }
        
        /* Add this CSS for the loading spinner */
        .spinner {
            border: 16px solid #f3f3f3; /* Light grey */
            border-top: 16px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
            margin: 0 auto; /* Center the spinner */
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .product-item {
            background-color: #282828;
            color: white;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            transition: background-color 0.3s;
            overflow: hidden;
        }
        .product-item:active {
            background-color: #323232;
            color: white;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }
        .buy-button {
            background-color: #0056b3;
            border-radius: 15px;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 5px;
            padding: 10px;
            width: 100%;
            cursor: pointer;
            font-size: 16px;
        }
        
        .buy-button:hover {
            background-color: #0056b3;
        }
        .product-location {
            padding: 5px;
            margin-top: 5px;
            background-color: #5757571a;
            border-radius: 11px;
        }
        
        .product-type {
            padding: 5px;
            margin-top: 5px;
            background-color: #5757571a;
            border-radius: 11px;
        }
        .product-item img {
            max-width: 150px;
            max-height: 150px;
            border-radius: 10px;
        }
        
        .product-item .product-name {
            position: relative;
            border-radius: 11px;
            font-weight: 500;
            left: 0;
                padding: 5px;
            background-color: #5757571a;
        }
        .product-price2 {
            margin-left: 100px;
            font-size: 16px;
            font-weight: 1000;
            color: rgb(152, 255, 121);
            padding: 5px;
            max-width: 50px;
            background-color: #2f2f2f;
            border-radius: 11px;
            position: relative;
            box-shadow: 0px 10px 100px 20px rgba(144, 238, 144, 0.7)
        }
        .product-item .product-price {
            font-size: 16px;
            font-weight: 1000;
            color: rgb(152, 255, 121);
            padding: 5px;
            max-width: 50px;
            background-color: #2f2f2f;
            border-radius: 11px;
            position: relative;
            box-shadow: 0px 10px 100px 20px rgba(144, 238, 144, 0.7)
        }
        .product-specific {
            padding: 10px;
            background-color: #2f2f2f;
            border-radius: 10px;
        }
        .filters {
            background-color:#282828 ;
            border-radius:15px;
            margin: 20px;
            padding: 10px;
            border: 2px solid #4d4c4c87;
        }
        
        .filters label {
            
            display: block;
            margin: 5px 0;
        }
        
        .filters select, .filters input {
            max-width: 100px;
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 10px;
            border: none;
            background-color: #282828;
            color: white;
        }
        
        .filters button {
            display: block;
            padding: 10px;
            border-radius: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }
        
        .filters button:hover {
            background-color: #0056b3;
        }
        
        
        .product-details-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 500px;
            background-color: #1d1d1d;
            border-radius: 15px;
            padding: 20px;
            color: white;
            z-index: 1000;
        }
        
        .product-details-menu .close-btn {
            background-color: #ff4c4c;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            color: white;
        }
        
        
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .telegram {
            width: 30px;
            margin: 0 auto;
            display: flex;
            color: white;
            border-radius: 100px;
            justify-content: space-between; 
        }
        .about-content {
            padding-top: 10px;
            
            max-width: 400px;
            width: 400px;
            height: 200px;
            border-radius: 15px;
            margin: 0 auto;
            margin-bottom: 20px;
        
            background-color: #292828;
        }
        
        .company-name {
            margin-bottom: 10px;
        
            margin-top: 10px;
            display: flex;
            color: white;
            justify-content: space-around; 
            }
        .about-content-img {
            display: flex;
            width: 100px;
            border-radius: 1000px;
            margin: 0 auto;
            justify-content: flex-end;
            flex-direction: column;
            flex-wrap: wrap;
            align-content: space-between;
        
        }
        .about-content2 {
            max-width: 400px;
            width: 400px;
            height: 100vh;
            border-radius: 15px;
            margin: 0 auto;
            background-color: #292828;
        }</style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">420</div>
        <ul class="menu">
            <li><a href="index.html">Գլխավոր մենյու</a></li>
            <li><a href="about.html">Մեր մասին            </a></li>
            <li><a href="services.html">Պատվերներ</a></li>
        </ul>
    </nav>

    <!-- Main Menu with Map and Product Grid -->
    <div class="main-menu">
        <div id="map"></div>
        <div class="filters">
            <select id="location-filter" onchange="applyFilters()">
                <option value="">Բոլոր Վայրերը
                </option>
                <option value="Ավան">Ավան</option>
                <option value="Զեյթուն">Զեյթւն</option>
                <option value="Բանգլադեշ">Բանգլադեշ</option>
                <option value="3-րդ Մաս">3րդ Մաս</option>
                <option value="Կոմիտաս">Կոմիտաս</option>
                <option value="Էրեբունի">Երեբւնի</option>
                <option value="Նորագավիթ">Նորագավիտ</option>
                <option value="Շենգավիթ">Շենգավիտ</option>
            </select>
            <select id="type-filter" onchange="applyFilters()">
                <option value="">Բոլոր Տեսակները
                </option>
                <option value="Indica">Indica</option>
                <option value="Sativa">Sativa</option>
            </select>
            <input type="number" id="price-filter" placeholder="Մաքս գինը" step="0.01" min="0" oninput="applyFilters()">
            <button id="apply-filters" onclick="applyFilters()">Որոնում</button>
        </div>
        
        
        <div class="product-menu">
            <div class="product-grid" id="product-grid"></div>
        </div>
    </div>

<!-- Modal for Payment Details -->
<!-- Modal for Payment Details -->
<div id="payment-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Վճարման մանրամասներ        </h2>

        <div id="qr-code"></div>
        <p id="dash-address">DASH Հասցե: <span id="address"></span></p>
        <p id="amount">Գումարը: <span id="amount-value"></span> DASH</p>
        <div class="loading"></div>

        <!-- Added product details -->
        <div id="product-details">
            <img id="product-image" src="" alt="Product Image" style="max-width: 150px; height: auto;"/>
            <p id="product-name"></p>
            <p id="product-price"></p>
        </div>
    </div>
</div>



    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.0/mapbox-gl.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize the map with default location
            initMap();
            $('#apply-filters').click(function() {
        var locationFilter = $('#location-filter').val();
        var typeFilter = $('#type-filter').val();
        var maxPrice = parseFloat($('#price-filter').val()) || Infinity;

        $('.product-item').each(function() {
            var itemLocation = $(this).data('location');
            var itemType = $(this).data('type');
            var itemPrice = parseFloat($(this).data('price').replace('$', ''));

            // Check if the item matches the filters
            var matchesLocation = locationFilter === '' || itemLocation === locationFilter;
            var matchesType = typeFilter === '' || itemType === typeFilter;
            var matchesPrice = itemPrice <= maxPrice;

            // Show or hide the item based on filter criteria
            if (matchesLocation && matchesType && matchesPrice) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    });
            function generateRandomColor() {
                return '#' + Math.floor(Math.random() * 16777215).toString(16);
            }

            function generateProductItems(numItems) {
    const container = document.getElementById('product-grid');
    const locations = [
    'Ավան', 'Զեյթուն', 'Բանգլադեշ', '3-րդ Մաս', 'Կոմիտաս',
        'Էրեբունի', 'Նորագավիթ', 'Շենգավիթ'
    ];
    const types = ['Indica', 'Sativa']; // Product types

    const baseLat = 40.177200; // Center of Yerevan
    const baseLng = 44.503490; // Center of Yerevan
    const latOffset = 0.02; // Adjust offset to cover a larger area
    const lngOffset = 0.02; // Adjust offset to cover a larger area

    // Array of image URLs
    const images = [
        'https://thenaturalremedy.store/wp-content/uploads/2024/06/jkbhkkghygvh-600x600.png',
        'https://thenaturalremedy.store/wp-content/uploads/2024/05/dosi-platinum-2-600x600.png',
        'https://thenaturalremedy.store/wp-content/uploads/2024/05/Frankies-1-600x600.png',
        'https://thenaturalremedy.store/wp-content/uploads/2020/12/new-weed-2-1-300x300.png',
        'https://thenaturalremedy.store/wp-content/uploads/2020/09/cmass-removebg-e1657104210586.png'
    ];

    for (let i = 0; i < numItems; i++) {
        const lat = baseLat + (Math.random() - 0.5) * latOffset * 2; // Spread over a larger area
        const lng = baseLng + (Math.random() - 0.5) * lngOffset * 2; // Spread over a larger area
        const color = generateRandomColor();
        const quantity = Math.floor(Math.random() * 100) + 1; // Random quantity for demonstration
        const location = locations[Math.floor(Math.random() * locations.length)];
        const type = types[Math.floor(Math.random() * types.length)];
        
        // Generate a random price between $25 and $45
        const price = (Math.random() * (45 - 25) + 25).toFixed(2);
        
        // Choose a random image URL
        const image = images[Math.floor(Math.random() * images.length)];

        const productItem = document.createElement('div');
        productItem.className = 'product-item';
        productItem.setAttribute('data-name', `Product ${i + 1}`);
        productItem.setAttribute('data-price', `$${price}`);
        productItem.setAttribute('data-description', `Description for Product ${i + 1}`);
        productItem.setAttribute('data-image', image);
        productItem.setAttribute('data-lat', lat.toFixed(6));
        productItem.setAttribute('data-lng', lng.toFixed(6));
        productItem.setAttribute('data-color', color);
        productItem.setAttribute('data-quantity', quantity);
        productItem.setAttribute('data-location', location);
        productItem.setAttribute('data-type', type);

        productItem.innerHTML = `
            <div class="product-price">$${price}</div>
            <img src="${image}" alt="Product ${i + 1} Image">
            <div class="product-specific">
                <div class="product-name">Աապրանք ${i + 1}</div>
                <div class="product-location">${location}</div>
                <div class="product-type">${type}</div>
            </div>
            <button class="buy-button">Գնել</button>
        `;

        container.appendChild(productItem);
    }
}

generateProductItems(100);

            $('.product-item').click(function() {
                var name = $(this).data('name');
                var price = $(this).data('price');
                var description = $(this).data('description');
                var image = $(this).data('image');
                var lat = parseFloat($(this).data('lat'));
                var lng = parseFloat($(this).data('lng'));

                $('#product-name').text(name);
                $('#product-price').text(price);
                $('#product-description').text(description);
                $('#product-image').attr('src', image);

                // Optionally update the map location and add GeoJSON layer
                initMap(lat, lng);

                $('#overlay').fadeIn();
                $('#product-details-menu').fadeIn();
            });

            $('#close-btn').click(function() {
                $('#product-details-menu').hide();
                $('#overlay').hide();
            });

            $('#overlay').click(function() {
                $('#product-details-menu').fadeOut();
                $('#overlay').fadeOut();
            });

            // Handle "Buy" button click
            $(document).on('click', '.buy-button', function() {
                var price = $(this).siblings('.product-price').text().replace('$', '');
                var dashAddress = 'XdAUmwtig27HBG6WfYyHAzP8n6XC9jESEw';
                var conversionRate = 0.05; // Example conversion rate from USD to DASH
                var amountInDASH = parseFloat(price) * conversionRate;

                // Get product details
                var productImage = $(this).siblings('img').attr('src');
                var productName = $(this).siblings('.product-specific').find('.product-name').text();
                var productPrice = $(this).siblings('.product-price').text();

                // Update modal with product details
                $('#address').text(dashAddress);
                $('#amount-value').text(amountInDASH.toFixed(2));
                $('#product-image').attr('src', productImage);
                $('#product-name').text(productName);
                $('#product-price').text(productPrice);

                // Show loading animation
                $('#loading-animation').show();
                $('#qr-code').hide();

                // Generate QR Code for DASH address
                var qr = qrcode(0, 'L');
                qr.addData(dashAddress);
                qr.make();
                $('#qr-code').html(qr.createImgTag(4));

                // Hide loading animation and show QR code
                $('#loading-animation').hide();
                $('#qr-code').show();

                // Open the modal
                $('#payment-modal').fadeIn();
            });

            // Close the modal
            $('.close-btn').click(function() {
                $('#payment-modal').fadeOut();
            });

            $('#payment-modal').click(function(event) {
                if ($(event.target).is('#payment-modal')) {
                    $('#payment-modal').fadeOut();
                }
            });

        });

        function initMap(lat = 40.177200, lng = 44.503490) {
            mapboxgl.accessToken = 'pk.eyJ1IjoibnVibWFzdGVyNjY2IiwiYSI6ImNseXVpN2cxNDByMHUybHNnOHZpcGppMHcifQ.n8AzCR_WFx-YDwy7G6z7Hg';

            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/dark-v11',
                center: [lng, lat],
                zoom: 15
            });

            map.on('load', function () {
                var features = [];

                $('.product-item').each(function() {
                    var lat = parseFloat($(this).data('lat'));
                    var lng = parseFloat($(this).data('lng'));
                    var color = $(this).data('color');
                    var quantity = $(this).data('quantity');

                    // Define the range for random distances in meters
                    const minDistanceMeters = 50;
                    const maxDistanceMeters = 150;

                    // Generate a random distance for each polygon
                    const distanceMeters = getRandomDistance(minDistanceMeters, maxDistanceMeters);
                    const radiusDegrees = distanceMeters * 0.00001;

                    // Calculate polygon coordinates
                    function generateCircleCoordinates(lng, lat, radius, points = 30) {
                        const coordinates = [];
                        for (let i = 0; i < points; i++) {
                            const angle = (i / points) * 2 * Math.PI;
                            const offsetLng = radius * Math.cos(angle);
                            const offsetLat = radius * Math.sin(angle);
                            coordinates.push([
                                lng + offsetLng,
                                lat + offsetLat
                            ]);
                        }
                        coordinates.push(coordinates[0]); // Close the polygon
                        return coordinates;
                    }

                    const coordinates = generateCircleCoordinates(lng, lat, radiusDegrees);

                    features.push({
                        "type": "Feature",
                        "properties": {
                            "title": $(this).data('name'),
                            "color": color,
                            "quantity": quantity
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [coordinates]
                        }
                    });

                    // Add a marker for each product
                    new mapboxgl.Marker({ color: color })
                        .setLngLat([lng, lat])
                        .setPopup(new mapboxgl.Popup().setHTML(`
                            <h3>${$(this).data('name')}</h3>
                            <p>Price: ${$(this).data('price')}</p>
                            <p>Description: ${$(this).data('description')}</p>
                        `))
                        .addTo(map);
                });

                var geojsonData = {
                    "type": "FeatureCollection",
                    "features": features
                };

                // Add GeoJSON data as a source on the map
                map.addSource('products', {
                    'type': 'geojson',
                    'data': geojsonData
                });

                // Add the fill layer for circular outlines
                map.addLayer({
                    'id': 'products-outline',
                    'type': 'fill',
                    'source': 'products',
                    'layout': {},
                    'paint': {
                        'fill-color': [
                            'case',
                            ['has', 'color'],
                            ['get', 'color'],
                            '#00f' // Default color if not specified
                        ],
                        'fill-opacity': 0.3,
                        'fill-outline-color': '#000'
                    }
                });

                // Add labels for quantities
                map.addLayer({
                    'id': 'products-labels',
                    'type': 'symbol',
                    'source': 'products',
                    'layout': {
                        'text-field': '{quantity}', // Display quantity
                        'text-font': ['Open Sans Bold', 'Arial Unicode MS Bold'],
                        'text-size': 12
                    },
                    'paint': {
                        'text-color': '#000000'
                    }
                });

                // Add a click event listener to display popup
                map.on('click', 'products-outline', (e) => {
                    var coordinates = e.features[0].geometry.coordinates[0][0];
                    var title = e.features[0].properties.title;
                    var quantity = e.features[0].properties.quantity;

                    new mapboxgl.Popup()
                        .setLngLat(coordinates)
                        .setHTML('<strong>' + title + '</strong><br>Quantity: ' + quantity)
                        .addTo(map);
                });
            });

            // Function to generate random distance within a range
            function getRandomDistance(min, max) {
                return Math.random() * (max - min) + min;
            }
        }
    </script>
</body>
</html>
